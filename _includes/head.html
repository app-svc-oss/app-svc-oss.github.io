<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {%- seo -%}
    <link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
    <!-- BEGIN: Favicon adding -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicons/site.webmanifest">
    <link rel="shortcut icon" type="image/x-icon" href="/assets/favicons/favicon.ico?">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/assets/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <!-- END: Favicon adding -->
    {%- feed_meta -%}
    <!-- {%- if jekyll.environment == 'production' and site.google_analytics -%}
    {%- include google-analytics.html -%}
    {%- include cookieconsent.html -%}
    {%- endif -%} -->
    <!-- Only add all this in production, why would I analyse myself when writing the post anyway. -->
    {% if jekyll.environment == 'production' %}

    <!-- Add cookie consent css & js -->
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>

    <!-- Add google analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NS8XQ5G03Q"></script>

    <script>
        // Reads the value of a cookie by name or returns empty string
        function getCookie(name) {
            var b = document.cookie.match('(^|[^;]+)\\s*' + name + '\\s*=\\s*([^;]+)');
            return b ? b.pop() : '';
        }

        // Actually starting analytics up
        function addAnalytics() {
            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());
            gtag('config', 'G-NS8XQ5G03Q');
        }

        // Waiting for the load event
        window.addEventListener("load", function () {
            // Reading "cookieconsent_status" cookie
            const cookieConsent = getCookie('cookieconsent_status');

            // Start analytics if user consented or did not deny
            if (cookieConsent === 'allow' || cookieConsent === '') {
                addAnalytics();
            }

            // Initialise cookie consent banner
            window.cookieconsent.initialise({
                "palette": {
                    "popup": {
                        "background": "#efefef",
                        "text": "#404040"
                    },
                    "button": {
                        "background": "#8ec760",
                        "text": "#ffffff"
                    }
                },
                "type": "opt-out",
                "content": {
                    "allow": "Approve",
                    "dismiss": "Approve",
                    "deny": "Reject"
                },
                // Reload the page on user choice to make sure cookie is set
                onStatusChange: function (status, chosenBefore) {
                    location.reload();
                }
            })
        });
    </script>
    {% endif %}
</head>